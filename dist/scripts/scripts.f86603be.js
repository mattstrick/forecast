"use strict";angular.module("forecastApp",["ngAnimate","ngSanitize","ngTouch"]),angular.module("forecastApp").controller("ForecastController",["request",function(a){function b(a){c.city=a[0],c.forecast=a.slice(1)}var c=this;c.validZipRegex=/(^\d{5}$)/,c.manualUpdate=function(){return c.validZipRegex.test(c.zip)?void a.getForecast(c.zip).then(function(a){a?(c.warning="",b(a)):c.warning="No forecast found. Zip code may be invalid."}):!1},c.autoUpdate=function(){c.loading=!0,a.getLocation().then(function(d){c.warning="",a.getZip(d.coords.latitude,d.coords.longitude).then(function(d){c.zip=d,a.getForecast(d).then(function(a){b(a),c.loading=!1})})},function(){c.warning="Geolocation is not enabled",c.zip="60661",a.getForecast(c.zip).then(function(a){b(a),c.loading=!1})})}}]),angular.module("forecastApp").factory("request",["$http","$q",function(a,b){var c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=function(b){var d={method:"GET",url:"http://api.openweathermap.org/data/2.5/forecast/daily?zip="+b+",us&units=imperial&cnt=6&APPID=a5f87f1a4aecee0a31c962e668559da3"};return a(d).then(function(a){var b,d,e,f=a.data,g=f.list.length,h=(new Date).getDay(),i=[];for(i.push(f.city.name),b=0;g>b;b++)d=f.list[b],e={weekday:c[h],temp:Math.floor(d.temp.day),high:Math.floor(d.temp.max),low:Math.floor(d.temp.min),sky:d.clouds,weather:d.weather[0].main},"Snow"===e.weather?e.weather="Chance of snow":"Rain"===e.weather&&(e.weather="Chance of rain"),i.push(e),h=(h+1)%7;return i},function(){console.log("request failed")})},e=function(){var a=b.defer();return window.navigator.geolocation?window.navigator.geolocation.getCurrentPosition(a.resolve,a.reject):a.reject("Browser does not support geolocation"),a.promise},f=function(b,c){return a.get("http://maps.googleapis.com/maps/api/geocode/json?latlng="+b+","+c).then(function(a){var b,c=a.data.results[0].address_components,d=c.length;for(b=0;d>b;b++)if(-1!==c[b].types.indexOf("postal_code"))return c[b].short_name})};return{getForecast:d,getLocation:e,getZip:f}}]),angular.module("forecastApp").run(["$templateCache",function(a){a.put("views/forecast.html",'<div class="row"> <div class="col-sm-7 col-sm-offset-3"> <div ng-if="forecastCtrl.forecast"> <h2> Forecast for {{forecastCtrl.city}} </h2> <div class="forecast"> <ul ng-repeat="day in forecastCtrl.forecast"> <li> <h3> {{ day.weekday }} </h3> </li> <li> {{ day.temp }} &deg F</li> <li> High: {{ day.high }} &deg F</li> <li> Low: {{ day.low }} &deg F</li> <li> {{ day.weather }}</li> <li> Cloud cover: {{ day.sky }} &#37 </li> </ul> </div> </div> </div></div>'),a.put("views/form.html",'<div class="row"> <div class="col-sm-6 col-sm-offset-3"> <div ng-if="forecastCtrl.warning" class="alert alert-danger" role="alert"> <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"> </span> <span class="sr-only">Error:</span> {{ forecastCtrl.warning }} </div> <form name="zipForm" ng-submit="forecastCtrl.manualUpdate()" ng-class="{\'submitted\': submitted}"> <div class="input-group"> <span class="input-group-btn"> <button type="button" class="btn btn-default btn-lg" ng-click="forecastCtrl.autoUpdate()"> <span class="glyphicon glyphicon-map-marker" aria-hidden="true"> </span> </button> </span> <input class="form-control input-lg" ng-model="forecastCtrl.zip" ng-pattern="forecastCtrl.validZipRegex" placeholder="Enter a zip code" required>  <span class="input-group-btn"> <button type="submit" class="btn btn-primary btn-lg">Submit</button> </span> </div> <div ng-if="zipForm.$invalid && zipForm.$submitted" class="alert alert-danger" role="alert"> <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"> </span> <span class="sr-only">Error:</span> Enter a valid 5 digit US zip code </div> </form> <h2 ng-if="forecastCtrl.loading" class="text-center"> Getting forecast... </h2> </div> </div>'),a.put("views/main.html","<div ng-include=\"'views/form.html'\"></div> <div ng-include=\"'views/forecast.html'\"></div>")}]);